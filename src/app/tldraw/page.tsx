"use client";

import { useCallback, useRef, useState } from "react";
import {
  createTLStore,
  defaultShapeUtils,
  Editor,
  getSnapshot,
  loadSnapshot,
  Tldraw,
  useEditor,
} from "tldraw";
import "tldraw/tldraw.css";
import { MyShapeUtil } from "./CustomShape";

const schema = {
  schemaVersion: 2,
  sequences: {
    "com.tldraw.store": 4,
    "com.tldraw.asset": 1,
    "com.tldraw.camera": 1,
    "com.tldraw.document": 2,
    "com.tldraw.instance": 25,
    "com.tldraw.instance_page_state": 5,
    "com.tldraw.page": 1,
    "com.tldraw.instance_presence": 6,
    "com.tldraw.pointer": 1,
    "com.tldraw.shape": 4,
    "com.tldraw.asset.bookmark": 2,
    "com.tldraw.asset.image": 5,
    "com.tldraw.asset.video": 5,
    "com.tldraw.shape.group": 0,
    "com.tldraw.shape.text": 2,
    "com.tldraw.shape.bookmark": 2,
    "com.tldraw.shape.draw": 2,
    "com.tldraw.shape.geo": 9,
    "com.tldraw.shape.note": 8,
    "com.tldraw.shape.line": 5,
    "com.tldraw.shape.frame": 0,
    "com.tldraw.shape.arrow": 5,
    "com.tldraw.shape.highlight": 1,
    "com.tldraw.shape.embed": 4,
    "com.tldraw.shape.image": 4,
    "com.tldraw.shape.video": 2,
    "com.tldraw.binding.arrow": 0,
  },
};

const snapshot = {
  store: {
    "document:document": {
      gridSize: 10,
      name: "",
      meta: {},
      id: "document:document",
      typeName: "document",
    },
    "page:page": {
      meta: {},
      id: "page:page",
      name: "Page 1",
      index: "a1",
      typeName: "page",
    },
    "shape:ovwuYqEYofQk0t2BQbLN9": {
      x: 542.96875,
      y: 606.5234375,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:ovwuYqEYofQk0t2BQbLN9",
      type: "note",
      props: {
        color: "black",
        size: "m",
        text: "hello BEAUTIFUL world",
        font: "draw",
        align: "middle",
        verticalAlign: "middle",
        labelColor: "black",
        growY: 0,
        fontSizeAdjustment: 22,
        url: "",
        scale: 1,
      },
      parentId: "page:page",
      index: "a1",
      typeName: "shape",
    },
    "shape:xJr2I3AtmZbHoOiw0mzpu": {
      x: 470.41015625,
      y: 252.49609375,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:xJr2I3AtmZbHoOiw0mzpu",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: -0.77, y: -0.74, z: 0.5 },
              { x: -4.74, y: -3.69, z: 0.5 },
              { x: -12.93, y: -8.26, z: 0.5 },
              { x: -23.89, y: -11.7, z: 0.5 },
              { x: -34.66, y: -12.79, z: 0.5 },
              { x: -43.95, y: -12.79, z: 0.5 },
              { x: -62.66, y: -11.25, z: 0.5 },
              { x: -89.12, y: -0.71, z: 0.5 },
              { x: -117.62, y: 21.3, z: 0.5 },
              { x: -143.01, y: 44.03, z: 0.5 },
              { x: -160.96, y: 65.52, z: 0.5 },
              { x: -174.17, y: 87.82, z: 0.5 },
              { x: -181.14, y: 114.6, z: 0.5 },
              { x: -183.71, y: 162.88, z: 0.5 },
              { x: -176.7, y: 183.2, z: 0.5 },
              { x: -150.91, y: 227.63, z: 0.5 },
              { x: -109.18, y: 267.19, z: 0.5 },
              { x: -69.63, y: 287.9, z: 0.5 },
              { x: -26.91, y: 295.56, z: 0.5 },
              { x: 27.45, y: 287.9, z: 0.5 },
              { x: 85.73, y: 249.11, z: 0.5 },
              { x: 141.51, y: 187.41, z: 0.5 },
              { x: 182.6, y: 128.61, z: 0.5 },
              { x: 206.55, y: 79.71, z: 0.5 },
              { x: 216.35, y: 41.27, z: 0.5 },
              { x: 212.88, y: 10.16, z: 0.5 },
              { x: 192.9, y: -18.01, z: 0.5 },
              { x: 152.11, y: -45.56, z: 0.5 },
              { x: 96.34, y: -71.7, z: 0.5 },
              { x: 33.57, y: -86.57, z: 0.5 },
              { x: -17.83, y: -90.4, z: 0.5 },
              { x: -53.18, y: -86.06, z: 0.5 },
              { x: -79.23, y: -74.58, z: 0.5 },
              { x: -93.21, y: -59.61, z: 0.5 },
              { x: -99.29, y: -43.23, z: 0.5 },
              { x: -101.12, y: -27.91, z: 0.5 },
              { x: -101.25, y: -19.3, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a26pw",
      typeName: "shape",
    },
    "shape:k2V8a9zRQ8jPEohJRW32e": {
      x: 388.31640625,
      y: 350.203125,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:k2V8a9zRQ8jPEohJRW32e",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: 0.15, y: -0.31, z: 0.5 },
              { x: 0.3, y: -0.73, z: 0.5 },
              { x: 0.3, y: -1.11, z: 0.5 },
              { x: -0.7, y: -1.99, z: 0.5 },
              { x: -2.76, y: -2.59, z: 0.5 },
              { x: -6.59, y: -2.59, z: 0.5 },
              { x: -12.05, y: -2.59, z: 0.5 },
              { x: -17.32, y: -2.38, z: 0.5 },
              { x: -22.66, y: 1.46, z: 0.5 },
              { x: -27.3, y: 11.24, z: 0.5 },
              { x: -29.46, y: 26.74, z: 0.5 },
              { x: -29.05, y: 45.48, z: 0.5 },
              { x: -24.11, y: 62.34, z: 0.5 },
              { x: -15.18, y: 73.11, z: 0.5 },
              { x: -4.97, y: 77.74, z: 0.5 },
              { x: 4.43, y: 78.57, z: 0.5 },
              { x: 11.63, y: 73.64, z: 0.5 },
              { x: 17.06, y: 63.08, z: 0.5 },
              { x: 20.04, y: 49.12, z: 0.5 },
              { x: 20.94, y: 35.13, z: 0.5 },
              { x: 18.2, y: 23.14, z: 0.5 },
              { x: 11.96, y: 13.5, z: 0.5 },
              { x: 3.78, y: 7.36, z: 0.5 },
              { x: -4.73, y: 4.21, z: 0.5 },
              { x: -12.27, y: 3.39, z: 0.5 },
              { x: -18.63, y: 3.39, z: 0.5 },
              { x: -22.66, y: 3.39, z: 0.5 },
              { x: -24.51, y: 3.55, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a33zj",
      typeName: "shape",
    },
    "shape:sUH4Z6P8qCglBXKEjIJi6": {
      x: 475.8359375,
      y: 296.60546875,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:sUH4Z6P8qCglBXKEjIJi6",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: -0.44, y: 0, z: 0.5 },
              { x: -3.87, y: 0, z: 0.5 },
              { x: -5.48, y: 0, z: 0.5 },
              { x: -8.25, y: 0, z: 0.5 },
              { x: -11.1, y: 0, z: 0.5 },
              { x: -13.86, y: 1.17, z: 0.5 },
              { x: -16.01, y: 7.52, z: 0.5 },
              { x: -17.73, y: 21.43, z: 0.5 },
              { x: -18.37, y: 40.2, z: 0.5 },
              { x: -18.37, y: 55.18, z: 0.5 },
              { x: -18.14, y: 64.03, z: 0.5 },
              { x: -15.09, y: 71.38, z: 0.5 },
              { x: -7.83, y: 75.69, z: 0.5 },
              { x: 9.24, y: 77.1, z: 0.5 },
              { x: 31.45, y: 77.66, z: 0.5 },
              { x: 51.9, y: 75.44, z: 0.5 },
              { x: 71.3, y: 67.22, z: 0.5 },
              { x: 86.25, y: 50.95, z: 0.5 },
              { x: 96.25, y: 20.72, z: 0.5 },
              { x: 99.37, y: -14.87, z: 0.5 },
              { x: 93.34, y: -46.02, z: 0.5 },
              { x: 79.17, y: -71.04, z: 0.5 },
              { x: 60.16, y: -85.61, z: 0.5 },
              { x: 39.99, y: -91.77, z: 0.5 },
              { x: 21.79, y: -92.87, z: 0.5 },
              { x: 6.07, y: -90.85, z: 0.5 },
              { x: -7.03, y: -84.59, z: 0.5 },
              { x: -16.84, y: -75.48, z: 0.5 },
              { x: -24.14, y: -64.64, z: 0.5 },
              { x: -28.53, y: -54.67, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a408m",
      typeName: "shape",
    },
    "shape:DaUU-5V4CueNN3qTSGRnm": {
      x: 431.79296875,
      y: 454.3984375,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:DaUU-5V4CueNN3qTSGRnm",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: 0, y: 0.21, z: 0.5 },
              { x: 1.59, y: 2.71, z: 0.5 },
              { x: 7.36, y: 10.29, z: 0.5 },
              { x: 15.42, y: 20.36, z: 0.5 },
              { x: 23.91, y: 29.73, z: 0.5 },
              { x: 32.57, y: 37.06, z: 0.5 },
              { x: 41.18, y: 41, z: 0.5 },
              { x: 51.95, y: 42.23, z: 0.5 },
              { x: 71, y: 42.23, z: 0.5 },
              { x: 93.18, y: 40.46, z: 0.5 },
              { x: 113.47, y: 33, z: 0.5 },
              { x: 137.45, y: 15.4, z: 0.5 },
              { x: 155.85, y: -6.85, z: 0.5 },
              { x: 163.9, y: -26.33, z: 0.5 },
              { x: 168.53, y: -46.49, z: 0.5 },
              { x: 170.65, y: -64.82, z: 0.5 },
              { x: 168.57, y: -77.54, z: 0.5 },
              { x: 161.9, y: -87.77, z: 0.5 },
              { x: 153.08, y: -96.25, z: 0.5 },
              { x: 145.53, y: -101.88, z: 0.5 },
              { x: 139.41, y: -105.36, z: 0.5 },
              { x: 135.13, y: -107.69, z: 0.5 },
              { x: 132.45, y: -109.2, z: 0.5 },
              { x: 132.33, y: -109.23, z: 0.5 },
              { x: 132.2, y: -109.37, z: 0.5 },
              { x: 132.2, y: -109.3, z: 0.5 },
              { x: 132.2, y: -108.82, z: 0.5 },
              { x: 132.2, y: -108.24, z: 0.5 },
              { x: 132.09, y: -107.66, z: 0.5 },
              { x: 131.8, y: -106.91, z: 0.5 },
              { x: 131.47, y: -106.13, z: 0.5 },
              { x: 130.95, y: -105.3, z: 0.5 },
              { x: 129.13, y: -103.62, z: 0.5 },
              { x: 124.99, y: -100.63, z: 0.5 },
              { x: 115.77, y: -94.84, z: 0.5 },
              { x: 96.38, y: -82.82, z: 0.5 },
              { x: 73.02, y: -68.52, z: 0.5 },
              { x: 51.36, y: -55.35, z: 0.5 },
              { x: 32.43, y: -42.98, z: 0.5 },
              { x: 18.25, y: -33.07, z: 0.5 },
              { x: 8.98, y: -26.47, z: 0.5 },
              { x: 4.77, y: -23.46, z: 0.5 },
              { x: 2.33, y: -21.98, z: 0.5 },
              { x: -0.99, y: -20.39, z: 0.5 },
              { x: -5.2, y: -18.65, z: 0.5 },
              { x: -9.16, y: -16.91, z: 0.5 },
              { x: -12.27, y: -15.49, z: 0.5 },
              { x: -13.95, y: -14.69, z: 0.5 },
              { x: -15.05, y: -14.07, z: 0.5 },
              { x: -15.05, y: -13.95, z: 0.5 },
              { x: -15.17, y: -13.71, z: 0.5 },
              { x: -15.29, y: -13.48, z: 0.5 },
              { x: -15.48, y: -13.3, z: 0.5 },
              { x: -16.99, y: -12.05, z: 0.5 },
              { x: -20.03, y: -9.29, z: 0.5 },
              { x: -23.66, y: -6.09, z: 0.5 },
              { x: -26.43, y: -3.6, z: 0.5 },
              { x: -27.74, y: -2.36, z: 0.5 },
              { x: -28.49, y: -1.62, z: 0.5 },
              { x: -28.49, y: -1.74, z: 0.5 },
              { x: -28.34, y: -2.14, z: 0.5 },
              { x: -28.07, y: -2.48, z: 0.5 },
              { x: -27.94, y: -2.61, z: 0.5 },
              { x: -27.82, y: -2.66, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a58RA",
      typeName: "shape",
    },
    "shape:CSNEripxAr9uZQCXNbzSN": {
      x: 482.65625,
      y: 351.015625,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:CSNEripxAr9uZQCXNbzSN",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: 0.11, y: 0, z: 0.5 },
              { x: 0.91, y: 0, z: 0.5 },
              { x: 3, y: 0, z: 0.5 },
              { x: 3.12, y: 0, z: 0.5 },
              { x: 3.24, y: 0.04, z: 0.5 },
              { x: 3.24, y: 0.93, z: 0.5 },
              { x: 3.24, y: 3.29, z: 0.5 },
              { x: 2.85, y: 6.75, z: 0.5 },
              { x: 1.54, y: 10.82, z: 0.5 },
              { x: -0.34, y: 15.13, z: 0.5 },
              { x: -1.82, y: 18.56, z: 0.5 },
              { x: -2.68, y: 20.36, z: 0.5 },
              { x: -3.15, y: 20.9, z: 0.5 },
              { x: -3.57, y: 20.91, z: 0.5 },
              { x: -4.18, y: 20.89, z: 0.5 },
              { x: -5.21, y: 20.49, z: 0.5 },
              { x: -6.65, y: 19.59, z: 0.5 },
              { x: -8.11, y: 18.89, z: 0.5 },
              { x: -9.48, y: 18.41, z: 0.5 },
              { x: -10.41, y: 17.97, z: 0.5 },
              { x: -10.86, y: 17.68, z: 0.5 },
              { x: -11.08, y: 17.32, z: 0.5 },
              { x: -11.16, y: 16.81, z: 0.5 },
              { x: -11.16, y: 16.09, z: 0.5 },
              { x: -11.16, y: 14.93, z: 0.5 },
              { x: -11.16, y: 13.48, z: 0.5 },
              { x: -11, y: 12.04, z: 0.5 },
              { x: -10.46, y: 10.32, z: 0.5 },
              { x: -9.92, y: 8.82, z: 0.5 },
              { x: -9.48, y: 8.15, z: 0.5 },
              { x: -8.92, y: 7.73, z: 0.5 },
              { x: -8.77, y: 7.73, z: 0.5 },
              { x: -8.34, y: 7.73, z: 0.5 },
              { x: -7.76, y: 7.77, z: 0.5 },
              { x: -7.19, y: 7.91, z: 0.5 },
              { x: -6.61, y: 8.14, z: 0.5 },
              { x: -5.88, y: 8.29, z: 0.5 },
              { x: -5.76, y: 8.29, z: 0.5 },
              { x: -5.53, y: 8.29, z: 0.5 },
              { x: -5.42, y: 8.09, z: 0.5 },
              { x: -5.29, y: 7.83, z: 0.5 },
              { x: -5.15, y: 7.75, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a67dX",
      typeName: "shape",
    },
    "shape:8I6_OJ0a_g8g-M-4SVaH0": {
      x: 385.06640625,
      y: 402.71484375,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:8I6_OJ0a_g8g-M-4SVaH0",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: -0.12, y: 0, z: 0.5 },
              { x: -0.12, y: 0, z: 0.5 },
              { x: 0.73, y: 0, z: 0.5 },
              { x: 2.2, y: 0.14, z: 0.5 },
              { x: 3.54, y: 0.6, z: 0.5 },
              { x: 4.54, y: 1.45, z: 0.5 },
              { x: 5.04, y: 2.24, z: 0.5 },
              { x: 5.3, y: 2.82, z: 0.5 },
              { x: 5.42, y: 3.43, z: 0.5 },
              { x: 5.42, y: 4, z: 0.5 },
              { x: 5.42, y: 4.54, z: 0.5 },
              { x: 5.42, y: 5.12, z: 0.5 },
              { x: 5.42, y: 5.94, z: 0.5 },
              { x: 5.42, y: 6.67, z: 0.5 },
              { x: 5.42, y: 7.42, z: 0.5 },
              { x: 5.42, y: 8.25, z: 0.5 },
              { x: 5.42, y: 9.06, z: 0.5 },
              { x: 5.42, y: 9.85, z: 0.5 },
              { x: 5.42, y: 10.39, z: 0.5 },
              { x: 5.42, y: 10.65, z: 0.5 },
              { x: 5.25, y: 10.66, z: 0.5 },
              { x: 4.8, y: 10.66, z: 0.5 },
              { x: 4.21, y: 10.45, z: 0.5 },
              { x: 3.63, y: 10.09, z: 0.5 },
              { x: 2.84, y: 9.79, z: 0.5 },
              { x: 2.07, y: 9.59, z: 0.5 },
              { x: 1.55, y: 9.39, z: 0.5 },
              { x: 1.11, y: 9.13, z: 0.5 },
              { x: 0.63, y: 8.99, z: 0.5 },
              { x: 0.04, y: 8.96, z: 0.5 },
              { x: -0.75, y: 8.96, z: 0.5 },
              { x: -1.53, y: 8.96, z: 0.5 },
              { x: -1.98, y: 8.82, z: 0.5 },
              { x: -2.43, y: 8.5, z: 0.5 },
              { x: -2.87, y: 8, z: 0.5 },
              { x: -3.58, y: 6.84, z: 0.5 },
              { x: -3.7, y: 6.66, z: 0.5 },
              { x: -3.97, y: 6.2, z: 0.5 },
              { x: -4.11, y: 5.62, z: 0.5 },
              { x: -4.11, y: 4.93, z: 0.5 },
              { x: -4.11, y: 4, z: 0.5 },
              { x: -4.11, y: 3.11, z: 0.5 },
              { x: -3.83, y: 2.36, z: 0.5 },
              { x: -3.74, y: 2.36, z: 0.5 },
              { x: -3.48, y: 2.36, z: 0.5 },
              { x: -3.04, y: 2.21, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a76zq",
      typeName: "shape",
    },
    "shape:W9MFtueXIgjW6PKfqx-uL": {
      x: 463.11328125,
      y: 422.00390625,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:W9MFtueXIgjW6PKfqx-uL",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: -0.13, y: 0, z: 0.5 },
              { x: -0.27, y: 0.27, z: 0.5 },
              { x: -0.27, y: 1.52, z: 0.5 },
              { x: -0.01, y: 3.37, z: 0.5 },
              { x: 0.51, y: 4.96, z: 0.5 },
              { x: 0.87, y: 6.2, z: 0.5 },
              { x: 1.01, y: 7.3, z: 0.5 },
              { x: 1.43, y: 9.1, z: 0.5 },
              { x: 2.23, y: 11.61, z: 0.5 },
              { x: 3.05, y: 13.94, z: 0.5 },
              { x: 3.64, y: 15.7, z: 0.5 },
              { x: 3.98, y: 16.73, z: 0.5 },
              { x: 4.4, y: 17.58, z: 0.5 },
              { x: 4.4, y: 17.7, z: 0.5 },
              { x: 4.43, y: 17.95, z: 0.5 },
              { x: 4.61, y: 18.25, z: 0.5 },
              { x: 4.91, y: 18.72, z: 0.5 },
              { x: 5.29, y: 19.29, z: 0.5 },
              { x: 5.66, y: 19.73, z: 0.5 },
              { x: 5.9, y: 20.05, z: 0.5 },
              { x: 6.02, y: 20.25, z: 0.5 },
              { x: 6.15, y: 20.28, z: 0.5 },
              { x: 6.26, y: 20.28, z: 0.5 },
              { x: 6.27, y: 20.18, z: 0.5 },
              { x: 6.41, y: 19.93, z: 0.5 },
              { x: 7.06, y: 19.27, z: 0.5 },
              { x: 8.32, y: 18.2, z: 0.5 },
              { x: 10.8, y: 16.62, z: 0.5 },
              { x: 15.28, y: 13.7, z: 0.5 },
              { x: 20.3, y: 10.67, z: 0.5 },
              { x: 24.42, y: 8.39, z: 0.5 },
              { x: 27.35, y: 6.48, z: 0.5 },
              { x: 28.72, y: 5.44, z: 0.5 },
              { x: 29.43, y: 5, z: 0.5 },
              { x: 29.43, y: 4.93, z: 0.5 },
              { x: 29.43, y: 4.82, z: 0.5 },
              { x: 29.43, y: 4.66, z: 0.5 },
              { x: 29.43, y: 4.47, z: 0.5 },
              { x: 29.43, y: 4.34, z: 0.5 },
              { x: 29.43, y: 4.18, z: 0.5 },
              { x: 29.43, y: 4.06, z: 0.5 },
              { x: 29.43, y: 3.96, z: 0.5 },
              { x: 29.36, y: 3.77, z: 0.5 },
              { x: 29.05, y: 3.45, z: 0.5 },
              { x: 28.51, y: 2.91, z: 0.5 },
              { x: 27.32, y: 1.53, z: 0.5 },
              { x: 24.1, y: -2.45, z: 0.5 },
              { x: 19.52, y: -8.72, z: 0.5 },
              { x: 15.28, y: -14.94, z: 0.5 },
              { x: 11.8, y: -20.08, z: 0.5 },
              { x: 9.41, y: -23.34, z: 0.5 },
              { x: 8.18, y: -24.66, z: 0.5 },
              { x: 7.81, y: -25.03, z: 0.5 },
              { x: 7.79, y: -24.92, z: 0.5 },
              { x: 7.79, y: -24.5, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a8AQH",
      typeName: "shape",
    },
    "shape:0g8pO55tYWsL5GV69wXH-": {
      x: 498.7265625,
      y: 394.78125,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:0g8pO55tYWsL5GV69wXH-",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: -0.12, y: 0, z: 0.5 },
              { x: -0.24, y: 0.43, z: 0.5 },
              { x: 0.79, y: 3.23, z: 0.5 },
              { x: 3.96, y: 11.16, z: 0.5 },
              { x: 8.53, y: 22.68, z: 0.5 },
              { x: 12.18, y: 33.12, z: 0.5 },
              { x: 14.27, y: 40.6, z: 0.5 },
              { x: 15.53, y: 44.58, z: 0.5 },
              { x: 15.93, y: 45.82, z: 0.5 },
              { x: 15.94, y: 46.11, z: 0.5 },
              { x: 15.94, y: 45.98, z: 0.5 },
              { x: 15.94, y: 45.14, z: 0.5 },
              { x: 15.94, y: 43.9, z: 0.5 },
              { x: 15.94, y: 42.69, z: 0.5 },
              { x: 15.94, y: 41.45, z: 0.5 },
              { x: 15.77, y: 40.16, z: 0.5 },
              { x: 15.37, y: 38.94, z: 0.5 },
              { x: 15.05, y: 37.7, z: 0.5 },
              { x: 14.95, y: 36.24, z: 0.5 },
              { x: 14.95, y: 34.58, z: 0.5 },
              { x: 14.95, y: 32.63, z: 0.5 },
              { x: 15.65, y: 30.77, z: 0.5 },
              { x: 18.13, y: 28.64, z: 0.5 },
              { x: 22, y: 26.03, z: 0.5 },
              { x: 26.1, y: 23.69, z: 0.5 },
              { x: 29.64, y: 22.07, z: 0.5 },
              { x: 31.87, y: 21.27, z: 0.5 },
              { x: 32.86, y: 20.96, z: 0.5 },
              { x: 33.64, y: 20.84, z: 0.5 },
              { x: 34.42, y: 20.79, z: 0.5 },
              { x: 35.29, y: 20.41, z: 0.5 },
              { x: 36.59, y: 19.45, z: 0.5 },
              { x: 38.03, y: 18.29, z: 0.5 },
              { x: 39.13, y: 17.36, z: 0.5 },
              { x: 39.73, y: 16.71, z: 0.5 },
              { x: 39.93, y: 16.39, z: 0.5 },
              { x: 39.83, y: 16.3, z: 0.5 },
              { x: 39.39, y: 16.3, z: 0.5 },
              { x: 38.52, y: 16.3, z: 0.5 },
              { x: 37.48, y: 16.28, z: 0.5 },
              { x: 35.94, y: 15.64, z: 0.5 },
              { x: 33.4, y: 13.44, z: 0.5 },
              { x: 29.19, y: 9.44, z: 0.5 },
              { x: 23.6, y: 4.63, z: 0.5 },
              { x: 17.55, y: 0.04, z: 0.5 },
              { x: 11.72, y: -3.86, z: 0.5 },
              { x: 7.72, y: -6.36, z: 0.5 },
              { x: 4.38, y: -8.14, z: 0.5 },
              { x: 1.29, y: -9.59, z: 0.5 },
              { x: -0.16, y: -10.27, z: 0.5 },
              { x: -0.83, y: -10.62, z: 0.5 },
              { x: -1.15, y: -11.02, z: 0.5 },
              { x: -1.18, y: -11.37, z: 0.5 },
              { x: -1.18, y: -11.51, z: 0.5 },
              { x: -1.18, y: -11.68, z: 0.5 },
              { x: -1.18, y: -11.58, z: 0.5 },
              { x: -1.18, y: -11.04, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "a97Gx",
      typeName: "shape",
    },
    "shape:zvtKxzkyIm9MoOpFTGCO9": {
      x: 475.5234375,
      y: 486.015625,
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      id: "shape:zvtKxzkyIm9MoOpFTGCO9",
      type: "draw",
      props: {
        segments: [
          {
            type: "free",
            points: [
              { x: 0, y: 0, z: 0.5 },
              { x: 0.2, y: 0, z: 0.5 },
              { x: 1.7, y: 0, z: 0.5 },
              { x: 5.93, y: 0, z: 0.5 },
              { x: 13.85, y: 0, z: 0.5 },
              { x: 25.94, y: -0.95, z: 0.5 },
              { x: 38.97, y: -3.82, z: 0.5 },
              { x: 50.67, y: -8.29, z: 0.5 },
              { x: 61.18, y: -13.77, z: 0.5 },
              { x: 69.8, y: -19.28, z: 0.5 },
              { x: 75.48, y: -23.51, z: 0.5 },
              { x: 78.87, y: -27.45, z: 0.5 },
              { x: 81.32, y: -31.09, z: 0.5 },
              { x: 82.7, y: -34.38, z: 0.5 },
              { x: 83.96, y: -38.42, z: 0.5 },
              { x: 85.88, y: -43.64, z: 0.5 },
              { x: 88.74, y: -50.37, z: 0.5 },
              { x: 92.29, y: -56.99, z: 0.5 },
              { x: 96.11, y: -62.8, z: 0.5 },
              { x: 98.94, y: -66.77, z: 0.5 },
              { x: 100.19, y: -68.38, z: 0.5 },
              { x: 101.05, y: -68.97, z: 0.5 },
              { x: 101.16, y: -68.97, z: 0.5 },
              { x: 101.38, y: -68.97, z: 0.5 },
              { x: 101.7, y: -68.97, z: 0.5 },
              { x: 101.98, y: -68.97, z: 0.5 },
              { x: 102.05, y: -68.9, z: 0.5 },
            ],
          },
        ],
        color: "black",
        fill: "none",
        dash: "draw",
        size: "m",
        isComplete: true,
        isClosed: false,
        isPen: false,
        scale: 1,
      },
      parentId: "page:page",
      index: "aAB70",
      typeName: "shape",
    },
  },
  schema,
} as const;

// "shape:ovwuYqEYofQk0t2BQbLN9": {
//   x: 542.96875,
//   y: 606.5234375,
//   rotation: 0,
//   isLocked: false,
//   opacity: 1,
//   meta: {},
//   id: "shape:ovwuYqEYofQk0t2BQbLN9",
//   type: "note",
//   props: {
//     color: "black",
//     size: "m",
//     text: "hello BEAUTIFUL world",
//     font: "draw",
//     align: "middle",
//     verticalAlign: "middle",
//     labelColor: "black",
//     growY: 0,
//     fontSizeAdjustment: 22,
//     url: "",
//     scale: 1,
//   },
//   parentId: "page:page",
//   index: "a1",
//   typeName: "shape",
// }

const snapshot2 = (function () {
  const n = 100;
  const w = 500;
  const h = 800;
  const cols = Math.sqrt(n);
  const store = {
    "document:document": {
      gridSize: 10,
      name: "",
      meta: {},
      id: "document:document",
      typeName: "document",
    },
    "page:page": {
      meta: {},
      id: "page:page",
      name: "Page 1",
      index: "a1",
      typeName: "page",
    },
    // "shape:ILPbyRLbOtAyOG474aiKA": {
    //   x: 54.663722248619464,
    //   y: 14.130432169699091,
    //   rotation: 0,
    //   isLocked: false,
    //   opacity: 1,
    //   meta: {},
    //   id: "shape:ILPbyRLbOtAyOG474aiKA",
    //   type: "my-custom-shape",
    //   parentId: "page:page",
    //   index: "a1",
    //   props: { w: 200, h: 200 },
    //   typeName: "shape",
    // },
  };
  for (let i = 0; i < n; i++) {
    const id = `shape:s${i}`;
    store[id] = {
      id,
      type: "my-custom-shape",
      x: (i % cols) * w,
      y: ~~(i / cols) * h,
      props: { w: 200, h: 200 },
      rotation: 0,
      isLocked: false,
      opacity: 1,
      meta: {},
      parentId: "page:page",
      index: "a1",
      typeName: "shape",
    };
  }
  return { store, schema };
})();

export default function App() {
  const mounted = useRef(false);

  const [store] = useState(() => {
    // console.log({ snapshot, snapshot2 });
    const newStore = createTLStore({ shapeUtils: [MyShapeUtil] });
    loadSnapshot(newStore, snapshot2);
    return newStore;
  });

  console.log(Date.now());

  const onMount = useCallback((editor: Editor) => {
    if (mounted.current) return;
    mounted.current = true;
    // editor.createShape({
    //   type: "my-custom-shape",
    //   x: Math.random() * 100,
    //   y: Math.random() * 100,
    // });
    // setTimeout(() => {
    //   const { document } = getSnapshot(editor.store);
    //   console.log({ document });
    // }, 2000);
  }, []);

  console.log(store);

  return (
    <div style={{ position: "fixed", inset: 0 }}>
      <Tldraw store={store} shapeUtils={[MyShapeUtil]} onMount={onMount} />
    </div>
  );
}
